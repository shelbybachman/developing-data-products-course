---
title: 'Predictors of Wine Quality App'
subtitle: 'Developing Data Products Course Project'
author: "Shelby Bachman"
date: "8/8/2019"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(data.table)
library(ggplot2)
library(ggfortify)
```

## Overview

The Predictors of Wine Quality app allows for the exploration and modeling of physicochemical properties that may relate to wine quality.

Data used in this app was obtained from [this link](http://www3.dsi.uminho.pt/pcortez/wine/) (Cortez et al., 2009). 

This dataset includes various properties (including acidity, density, sulfate levels and more) for different varieties of red and white wines from the Portuguese [vinho verde](http://www.vinhoverde.pt/en/) variety. 

Critically, the dataset also includes a quality rating for each wine ranging from 0 (worst) to 10 (best).

## The App

This app has three main functionalities: 

- **exploration of variables** in this dataset reflecting different physicochemical properties of vinho verde wine
- constructing and evaluating multiple linear **regression** models to examine the relationship between selected
- **prediction** of wine quality based on inputted values of various physicochemical properties

## Explore Variables Tab

On the first tab, you have the opportunity to explore each physicochemical property variable on its own. To start exploring:

1. First, select the type of wine in which you are interested (*red* or *white*).
2. Next, choose which of the 6 physicochemical properties you would like to explore.
3. Choose whether or not you would like to remove outliers (i.e. label them NA) during the exploration.

(*In all parts of the app, outliers for a given variable are classified as falling outside 1.5 times the interquartile range for that variable.*)

***

One you select the relevant inputs, you will see four outputs appear: 

1. A **summary table** displays various measures of central tendency as well as the minimum and maximum values for the variable.
2. A **boxplot** displays the spread of the variable.
3. A **histogram** displays the distribution of the variable.
4. A **scatterplot** consisting of the variable plotted against wine quality. The raw data along with a linear regression line is plotted.

***

For instance, you might be interested in exploring density values for white vinho verde wines, without removing outliers. The boxplot and scatterplot as shown below, along with the other results, would give you an overview of these values:

```{r explore}

data <- fread('./data/prepared_data/wine_data.csv') %>%
  filter(type == 'white') %>%
  select(density, quality)

par(mfrow = c(1,2))

p1 <- boxplot(data$density, col = "#BEDE7E", xlab = "density", height = 200)

p2 <- plot(data$density, data$quality,
     xlab = "density", ylab = "wine quality",
     col = "#BEDE7E",
     abline(lm(quality ~ density, data = data), lwd = 3))

```

*Notice that choosing the exclude outliers option might be fruitful.*

***

The code to run the explore step described on the last slide is shown below:

```{r explore_show, echo = TRUE, eval = FALSE}

data <- fread('./data/prepared_data/wine_data.csv') %>%
  filter(type == 'white') %>%
  select(density, quality)

par(mfrow = c(1,2))
p1 <- boxplot(data$density, col = "#BEDE7E", xlab = "density", height = 200)
p2 <- plot(data$density, data$quality,
     xlab = "density", ylab = "wine quality",
     col = "#BEDE7E",
     abline(lm(quality ~ density, data = data), lwd = 3))

```

## Regression Tab

On the second tab, you have the opportunity to construct a multiple linear regression model examining the relationship between predictors of your choosing and wine quality. To do so:

1. First, select the type of wine in which you are interested (*red* or *white*).
2. Next, choose which of the 6 physicochemical properties you would like to include in your model (*acidity*, *alcohol*, *chlorides*, *density*, *sugar*, *sulfates*).
3. Choose whether or not you would like to remove outliers (i.e. label them NA) during the model fit process.

***

Continuing with the previous example, you might be interested in modeling quality of white vinho verde based on only *acidity*, *density*, and *sulfates*, without removing outliers. After inputting these options, the app would display a summary of the model fit along with diagnostic plots such as those below: 

```{r regression, fig.height = 3}

data <- fread('./data/prepared_data/wine_data.csv') %>%
  filter(type == 'white') %>%
  select(-type)

my_model <- lm(quality ~ acidity + density + sulfates, data = data)
autoplot(my_model, ncol = 2, label.size = 3, colour = "#BEDE7E") + theme_bw()

```

This model fit has an R-squared value of `r summary(my_model)$r.squared`. You could try to improve it by adding more predictors and removing outliers, all of which are options in the app.

***

The code to run the regression step described on the last slide is shown below:

```{r regression_show, echo = TRUE, eval = FALSE}

data <- fread('./data/prepared_data/wine_data.csv') %>%
  filter(type == 'white') %>%
  select(-type)

my_model <- lm(quality ~ acidity + density + sulfates, 
               data = data)
autoplot(my_model, ncol = 2, 
         label.size = 3, colour = "#BEDE7E") + 
  theme_bw()

```

## Prediction Tab

On the third tab, you can. For simplicity, this prediction algorithm uses a multiple linear regression model consisting of all 6 predictors. To make a prediction:

1. First, select the type of wine in which you are interested (*red* or *white*).
2. Next, use the sliders to set values for each physicochemical property: *acidity*, *alcohol*, *chlorides*, *density*, *sugar*, and *sulfates*.
3. Choose whether or not you would like to remove outliers (i.e. label them NA) during the prediction process.

***

For instance, you might be interested in predicting the quality of a white vinho verde, without removing outliers, with the following inputs:

`acidity` = 0.7, `alcohol` = 12%, `chlorides` = 0.2, `density` = 0.998, `sugars` = 4.7, `sulfates` = 1.32

After inputting these options, the app would display the predicted quality value (shown below):

```{r prediction}

predicted_value <- round(
  as.vector(
  predict(my_model, newdata = data.frame(
    acidity = 0.7, alcohol = 12,
    chlorides = 0.2, density = 0.998,
    sugar = 4.7, sulfates = 1.32))), 
  digits = 1)

```

`r predicted_value` /10

In addition, the prediction tab includes a separate plot for each variable, showing the raw data versus quality in gray. The colored dots overlaid on each plot update as you change the inputs. The y-value of the dots reflect the predicted quality value at the specified value of the variable, if all other variables were held at their mean values.

*** 

The code to run the prediction step described on the last slide is shown below:

```{r prediction_show, echo = TRUE, eval = FALSE}

predicted_value <- round(
  as.vector(
  predict(my_model, newdata = data.frame(
    acidity = 0.7, alcohol = 12,
    chlorides = 0.2, density = 0.998,
    sugar = 4.7, sulfates = 1.32))), 
  digits = 1)

```

## Testing the app

You can find the Predictors of Wine Quality app at [this link](). 

Enjoy!
